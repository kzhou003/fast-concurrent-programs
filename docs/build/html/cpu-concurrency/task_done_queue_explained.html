

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Without task_done() - Can’t Track Completion &mdash; Fast Concurrent Programming Guide 1.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=1aac1d93" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=f2a433a1"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../_static/sidebar-fix.js?v=6c2f6f50"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Regular Lock vs RLock" href="rlock_explained.html" />
    <link rel="prev" title="The Answer" href="queue_internal_mechanics.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Fast Concurrent Programming Guide
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">CPU Concurrency</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html">Concurrency</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#parallelism">Parallelism</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#visual-comparison">Visual Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#threading-concurrent-futures-threadpoolexecutor">Threading (concurrent.futures.ThreadPoolExecutor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#multiprocessing-concurrent-futures-processpoolexecutor">Multiprocessing (concurrent.futures.ProcessPoolExecutor)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#when-to-use-what">When to Use What</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#what-is-the-gil">What is the GIL?</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#key-points">Key Points:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#impact-on-performance">Impact on Performance:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#observing-the-gil-from-script-06">Observing the GIL (from script 06):</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#event-loop">Event Loop</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#how-it-works-from-script-07">How It Works (from script 07):</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#event-loop-lifecycle">Event Loop Lifecycle:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#modern-vs-old-patterns">Modern vs Old Patterns:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#what-are-coroutines">What are Coroutines?</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#defining-coroutines">Defining Coroutines:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#key-features">Key Features:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#example-from-script-08">Example from Script 08:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#execution-flow">Execution Flow:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#important-rules">Important Rules:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#tasks">Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#task-characteristics">Task Characteristics:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#example-from-script-09">Example from Script 09:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#futures">Futures</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#waiting-for-multiple-tasks">Waiting for Multiple Tasks:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#cpu-bound-operations">CPU-bound Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#i-o-bound-operations">I/O-bound Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#comparison-table">Comparison Table:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#hybrid-workloads">Hybrid Workloads:</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#time-measurement-time-clock-time-perf-counter">1. Time Measurement (<code class="docutils literal notranslate"><span class="pre">time.clock()</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">time.perf_counter()</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#coroutine-syntax-asyncio-coroutine-async-def">2. Coroutine Syntax (<code class="docutils literal notranslate"><span class="pre">&#64;asyncio.coroutine</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">async</span> <span class="pre">def</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#task-creation-asyncio-task-asyncio-create-task">3. Task Creation (<code class="docutils literal notranslate"><span class="pre">asyncio.Task()</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">asyncio.create_task()</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#event-loop-management">4. Event Loop Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#future-callbacks-callbacks-await">5. Future Callbacks (Callbacks -&gt; <code class="docutils literal notranslate"><span class="pre">await</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#blocking-calls-in-async-code">6. Blocking Calls in Async Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#string-formatting-f-strings">7. String Formatting (<code class="docutils literal notranslate"><span class="pre">%</span></code> -&gt; f-strings)</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#migration-checklist">Migration Checklist</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#compatibility">Compatibility</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#quick-reference-guide">Quick Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#key-takeaways">Key Takeaways</a></li>
<li class="toctree-l1"><a class="reference internal" href="key_concepts.html#further-reading">Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html">Physical Cores</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#logical-cores">Logical Cores</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#the-concept">The Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#how-it-works">How It Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#technical-implementation">Technical Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#hyperthreading-limitations">Hyperthreading Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#checking-hyperthreading-status">Checking Hyperthreading Status</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#the-fundamental-constraint">The Fundamental Constraint</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#optimal-worker-count">Optimal Worker Count</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#real-world-example">Real-World Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#cpu-vs-gpu-different-design-philosophies">CPU vs GPU: Different Design Philosophies</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#key-differences">Key Differences</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#simd-and-gpu-architecture">SIMD and GPU Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#why-gpus-excel-at-compute-intensive-tasks">Why GPUs Excel at Compute-Intensive Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#what-gpus-are-good-at">What GPUs Are Good At</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#silicon-real-estate-comparison">Silicon Real Estate Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#performance-comparison">Performance Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#detailed-benchmark-results">Detailed Benchmark Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#decision-matrix">Decision Matrix</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#practical-guidelines">Practical Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#example-1-image-processing">Example 1: Image Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#example-2-monte-carlo-simulation">Example 2: Monte Carlo Simulation</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#example-3-neural-network-training">Example 3: Neural Network Training</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#core-principles">Core Principles</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#quick-reference">Quick Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="hardware_parallelism.html#key-takeaways">Key Takeaways</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html">Key Points About start()</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#example">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#key-points-about-join">Key Points About join()</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#id1">Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#without-join-danger">WITHOUT join() - DANGER!</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#with-join-correct">WITH join() - CORRECT!</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#mistake-1-calling-the-function-directly-instead-of-start">Mistake 1: Calling the function directly instead of start()</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#mistake-2-forgetting-join">Mistake 2: Forgetting join()</a></li>
<li class="toctree-l1"><a class="reference internal" href="threading_basics.html#mistake-3-thinking-threads-share-data-automatically">Mistake 3: Thinking threads share data automatically</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_event_loop.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_event_loop.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_coroutine.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_coroutine.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_coroutine.html#use-cases">Use Cases</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_and_futures.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_and_futures.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_task_manipulation.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="asyncio_task_manipulation.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrent_futures_pooling.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrent_futures_pooling.html#usage">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#internal-structure">Internal Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#automatic-locking">Automatic Locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#put-item"><code class="docutils literal notranslate"><span class="pre">put(item)</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#problem-with-manual-locks">Problem with Manual Locks</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#how-queue-does-locking">How Queue Does Locking</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#locking-benefits">Locking Benefits</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#execution-flow">Execution Flow</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#thread-safe-data-structure">1. <strong>Thread-Safe Data Structure</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#blocks-correctly">2. <strong>Blocks Correctly</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#no-busy-waiting">3. <strong>No Busy-Waiting</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#task-tracking">4. <strong>Task Tracking</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#safe-for-multiple-producers-consumers">5. <strong>Safe for Multiple Producers/Consumers</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#step-by-step-what-happens-in-put">Step-by-Step: What Happens in <code class="docutils literal notranslate"><span class="pre">put()</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#step-by-step-what-happens-in-get">Step-by-Step: What Happens in <code class="docutils literal notranslate"><span class="pre">get()</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#mistake-1-forgetting-lock">Mistake 1: Forgetting Lock</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#mistake-2-busy-waiting">Mistake 2: Busy-Waiting</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_explained.html#mistake-3-race-condition">Mistake 3: Race Condition</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_internal_mechanics.html">The Answer</a></li>
<li class="toctree-l1"><a class="reference internal" href="queue_internal_mechanics.html#summary">Summary</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Without task_done() - Can’t Track Completion</a></li>
<li class="toctree-l1"><a class="reference internal" href="#internal-counter-system">Internal Counter System</a></li>
<li class="toctree-l1"><a class="reference internal" href="#visual-timeline">Visual Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="#code-simplified">Code (Simplified)</a></li>
<li class="toctree-l1"><a class="reference internal" href="#two-operations">Two Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="#timeline-all-three-conditions">Timeline: All Three Conditions</a></li>
<li class="toctree-l1"><a class="reference internal" href="#put">put()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#get">get()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#task-done">task_done()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#join">join()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#scenario-1-producer-1-consumer">Scenario: 1 Producer, 1 Consumer</a></li>
<li class="toctree-l1"><a class="reference internal" href="#step-1-put-increment-counter">Step 1: put() - Increment Counter</a></li>
<li class="toctree-l1"><a class="reference internal" href="#diagram-tracking-one-task">Diagram: Tracking One Task</a></li>
<li class="toctree-l1"><a class="reference internal" href="#diagram-multiple-tasks">Diagram: Multiple Tasks</a></li>
<li class="toctree-l1"><a class="reference internal" href="#counter">Counter</a></li>
<li class="toctree-l1"><a class="reference internal" href="#condition-variable">Condition Variable</a></li>
<li class="toctree-l1"><a class="reference internal" href="#together">Together</a></li>
<li class="toctree-l1"><a class="reference internal" href="#without-all-tasks-done-condition">Without all_tasks*done Condition</a></li>
<li class="toctree-l1"><a class="reference internal" href="#queue-join-without-task-done">Queue.join() Without task_done()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#why-it-blocks-forever">Why It Blocks Forever</a></li>
<li class="toctree-l1"><a class="reference internal" href="#queue-join-with-task-done">Queue.join() With task_done()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#why-it-works">Why It Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="#step-1-put-item">Step 1: Put Item</a></li>
<li class="toctree-l1"><a class="reference internal" href="#step-2-get-and-process">Step 2: Get and Process</a></li>
<li class="toctree-l1"><a class="reference internal" href="#step-3-mark-done">Step 3: Mark Done</a></li>
<li class="toctree-l1"><a class="reference internal" href="#flow-diagram">Flow Diagram</a></li>
<li class="toctree-l1"><a class="reference internal" href="#without-task-done-problematic">Without task_done() - PROBLEMATIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="#use-case-1-verify-all-work-complete">Use Case 1: Verify All Work Complete</a></li>
<li class="toctree-l1"><a class="reference internal" href="#use-case-2-track-progress">Use Case 2: Track Progress</a></li>
<li class="toctree-l1"><a class="reference internal" href="#use-case-3-batch-processing">Use Case 3: Batch Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="#scenario-main-thread-needs-to-know-when-workers-finish">Scenario: Main thread needs to know when workers finish</a></li>
<li class="toctree-l1"><a class="reference internal" href="#timeline">Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="#better-code-pattern">Better Code Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="#why-we-need-task-done">Why We Need task_done()</a></li>
<li class="toctree-l1"><a class="reference internal" href="#the-pattern">The Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlock_explained.html">Regular Lock vs RLock</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlock_explained.html#why-rlock-is-needed-here">Why RLock is Needed Here</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlock_explained.html#use-regular-lock-when">Use Regular Lock When:</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlock_explained.html#use-rlock-when">Use RLock When:</a></li>
<li class="toctree-l1"><a class="reference internal" href="rlock_explained.html#regular-lock-would-deadlock">Regular Lock - Would Deadlock</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html">Key Concept</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#counting-semaphore-counter-1">1. Counting Semaphore (Counter &gt; 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#binary-semaphore-counter-0-or-1">2. Binary Semaphore (Counter = 0 or 1)</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#execution-timeline">Execution Timeline</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#acquire"><code class="docutils literal notranslate"><span class="pre">acquire()</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#counting-semaphore-3-spots-available">Counting Semaphore (3 spots available)</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#example-1-swimming-pool-with-limited-capacity">Example 1: Swimming Pool with Limited Capacity</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#limiting-concurrent-access">1. <strong>Limiting Concurrent Access</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#synchronizing-multiple-threads">3. <strong>Synchronizing Multiple Threads</strong></a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#lock-threading-lock">Lock (<code class="docutils literal notranslate"><span class="pre">threading.Lock</span></code>)</a></li>
<li class="toctree-l1"><a class="reference internal" href="semaphore_explained.html#semaphore-counting">Semaphore (Counting)</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html">What is the GIL?</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#why-does-python-have-a-gil">Why Does Python Have a GIL?</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#how-the-gil-works">How the GIL Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#gil-behavior-with-different-operations">GIL Behavior with Different Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-critical-difference">The Critical Difference</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#cpu-bound-operations">CPU-bound Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#i-o-bound-operations">I/O-bound Operations</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#real-world-analogy">Real-World Analogy</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-problem-with-threading-for-cpu-bound">The Problem with Threading for CPU-bound</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-solution-multiprocessing">The Solution: Multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#how-multiprocessing-bypasses-the-gil">How Multiprocessing Bypasses the GIL</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#trade-offs-of-multiprocessing">Trade-offs of Multiprocessing</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#when-the-trade-off-is-worth-it">When the Trade-off is Worth It</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-problem-wasted-time">The Problem: Wasted Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-solution-threading">The Solution: Threading</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#why-threading-works-for-i-o">Why Threading Works for I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#how-the-os-helps">How the OS Helps</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#performance-comparison">Performance Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#why-not-multiprocessing-for-i-o">Why Not Multiprocessing for I/O?</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-problem-with-threading-overhead">The Problem with Threading: Overhead</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#asyncio-cooperative-multitasking">Asyncio: Cooperative Multitasking</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#how-asyncio-works">How Asyncio Works</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#event-loop-visualization">Event Loop Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#asyncio-vs-threading-detailed-comparison">Asyncio vs Threading: Detailed Comparison</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#performance-characteristics">Performance Characteristics</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#when-asyncio-shines">When Asyncio Shines</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#cpu-bound-with-threading-the-gil-dance">CPU-bound with Threading: The GIL Dance</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#benchmark-cpu-bound-task-computing-pi">Benchmark: CPU-bound Task (Computing pi)</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#benchmark-i-o-bound-task-web-requests">Benchmark: I/O-bound Task (Web Requests)</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#benchmark-mixed-workload">Benchmark: Mixed Workload</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#quick-reference-table">Quick Reference Table</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#code-templates">Code Templates</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#the-gil-controls-everything">1. The GIL Controls Everything</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#resource-usage-matters">2. Resource Usage Matters</a></li>
<li class="toctree-l1"><a class="reference internal" href="patterns_problems_mapping.html#know-your-workload">4. Know Your Workload</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GPU Concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/gpu-fundamentals.html">Key Differences: CPU vs GPU</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/gpu-fundamentals.html#streaming-multiprocessors-sms">Streaming Multiprocessors (SMs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/gpu-fundamentals.html#thread-organization">Thread Organization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/gpu-fundamentals.html#example-visualization">Example Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/memory-hierarchy.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/memory-hierarchy.html#l2-cache">L2 Cache</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/memory-hierarchy.html#registers">Registers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/memory-hierarchy.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html">Warps and SIMD Execution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#thread-divergence">Thread Divergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#what-is-occupancy">What is Occupancy?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#factors-limiting-occupancy">Factors Limiting Occupancy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#example-calculation">Example Calculation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#why-occupancy-matters">Why Occupancy Matters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#the-occupancy-sweet-spot">The Occupancy Sweet Spot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#grid-and-block-dimensions">Grid and Block Dimensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#choosing-block-size">Choosing Block Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#within-a-block">Within a Block</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#between-blocks">Between Blocks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#warp-shuffles">Warp Shuffles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#warp-level-reductions">Warp-Level Reductions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#overlap-compute-and-memory">Overlap Compute and Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#traditional-approach">Traditional Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#persistent-approach">Persistent Approach</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#key-factors">Key Factors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/execution-model.html#profiling-tools">Profiling Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html">Step 1: Profile First</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#step-2-identify-bottleneck">Step 2: Identify Bottleneck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-1-kernel-fusion">Strategy 1: Kernel Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-2-tiling">Strategy 2: Tiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-3-vectorized-loads">Strategy 3: Vectorized Loads</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-4-memory-coalescing">Strategy 4: Memory Coalescing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-1-use-tensor-cores">Strategy 1: Use Tensor Cores</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-2-increase-arithmetic-intensity">Strategy 2: Increase Arithmetic Intensity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-3-minimize-thread-divergence">Strategy 3: Minimize Thread Divergence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-4-optimize-loop-structure">Strategy 4: Optimize Loop Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-1-reduce-register-usage">Strategy 1: Reduce Register Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-2-tune-shared-memory">Strategy 2: Tune Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#strategy-3-adjust-block-size">Strategy 3: Adjust Block Size</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#why-auto-tune">Why Auto-Tune?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#triton-auto-tuning">Triton Auto-Tuning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#warp-specialization">Warp Specialization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#persistent-kernels">Persistent Kernels</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#recomputation">Recomputation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#pattern-reduction">Pattern: Reduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#pattern-element-wise">Pattern: Element-wise</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#pattern-matrix-multiply">Pattern: Matrix Multiply</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#issue-low-bandwidth">Issue: Low Bandwidth</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#issue-low-compute-utilization">Issue: Low Compute Utilization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#issue-lower-than-pytorch">Issue: Lower Than PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#before-you-optimize">Before You Optimize</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#memory-optimizations">Memory Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#compute-optimizations">Compute Optimizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#occupancy-optimization">Occupancy Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/performance-optimization.html#advanced">Advanced</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-concepts/triton-concepts.html">Triton Concepts</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">GPU Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/01-vector-add.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/01-vector-add.html#next-steps">Next Steps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/02-fused-softmax.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/02-fused-softmax.html#extensions">Extensions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/03-matrix-multiplication.html">Matrix Multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/04-low-memory-dropout.html">Low Memory Dropout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/05-layer-norm.html">Layer Norm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/06-fused-attention.html">Fused Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/07-extern-functions.html">Extern Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/08-grouped-gemm.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/08-grouped-gemm.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/09-persistent-matmul.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/09-persistent-matmul.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/10-block-scaled-matmul.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gpu-tutorials/10-block-scaled-matmul.html#summary">Summary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Triton Compiler</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html">Key Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#stage-1-python-ast-parsing">Stage 1: Python AST Parsing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#stage-2-code-generation-ttir">Stage 2: Code Generation (TTIR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#stage-3-triton-gpu-ir-ttgir">Stage 3: Triton GPU IR (TTGIR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#stage-4-llvm-ir">Stage 4: LLVM IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#block-based-programming-model">Block-based Programming Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#jit-compilation">JIT Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#mlir-infrastructure">MLIR Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#python-components">Python Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#c-components">C++ Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/01-overview.html#backend-components">Backend Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/02-jit-decorator.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/02-jit-decorator.html#summary">Summary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html">CodeGenerator Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#ast-visitor-pattern">AST Visitor Pattern</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#type-inference">Type Inference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#compilation-orchestration">Compilation Orchestration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#ttgir-llvm-ir">TTGIR -&gt; LLVM IR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#llvm-ir-ptx">LLVM IR -&gt; PTX</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#cache-key-components">Cache Key Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/03-compilation-pipeline.html#cache-directory-structure">Cache Directory Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html">The NVCC Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#the-llvm-path">The LLVM Path</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#llvm-ir-stage">LLVM IR Stage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#ptx-generated-by-triton">PTX Generated by Triton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#same-tools-same-artifacts">Same Tools, Same Artifacts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#source-language">Source Language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#compiler-stack">Compiler Stack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#compilation-time">Compilation Time</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#can-triton-and-cuda-c-work-together">Can Triton and CUDA C++ Work Together?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#advantages-of-llvm-backend">Advantages of LLVM Backend</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#why-not-use-nvcc">Why Not Use NVCC?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#trade-offs">Trade-offs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#file-types">File Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#example-directory-structures">Example Directory Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#ptx-inspection">PTX Inspection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#compilation-paths-compared">Compilation Paths Compared</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/04-cuda-comparison.html#key-takeaways">Key Takeaways</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html">Traditional Compiler Limitations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#example-matrix-multiplication">Example: Matrix Multiplication</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#mlir-philosophy">MLIR Philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#dialects">1. Dialects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#why-triton-uses-mlir">Why Triton Uses MLIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#triton-s-mlir-dialects">Triton’s MLIR Dialects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#python-source">Python Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#stage-2-tritongpu-ir-ttgir">Stage 2: TritonGPU IR (TTGIR)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#stage-3-llvm-dialect">Stage 3: LLVM Dialect</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#stage-4-llvm-ir-actual">Stage 4: LLVM IR (Actual)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#command-line-tools">Command-Line Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#debugging-mlir">Debugging MLIR</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#official-documentation">Official Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#tutorials">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#triton-specific">Triton-Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#key-concepts-recap">Key Concepts Recap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#why-mlir-matters-for-triton">Why MLIR Matters for Triton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../triton-compiler/05-mlir-concepts.html#the-big-picture">The Big Picture</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../learning-paths.html">Learning Paths</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html">CUDA Out of Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#out-of-shared-memory">Out of Shared Memory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#wrong-results">Wrong Results</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#nan-or-inf-values">NaN or Inf Values</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#slower-than-pytorch">Slower Than PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#low-gpu-utilization">Low GPU Utilization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#compilation-errors">Compilation Errors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#slow-compilation">Slow Compilation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#nvidia-specific">NVIDIA-Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#amd-specific">AMD-Specific</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#wrong-gpu-selected">Wrong GPU Selected</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#print-debugging">Print Debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#profiling">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#assertions">Assertions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#unit-testing">Unit Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting.html#when-stuck">When Stuck</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html">Triton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#cuda">CUDA</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#rocm-amd">ROCm (AMD)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#pytorch">PyTorch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#flash-attention">Flash Attention</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#normalization">Normalization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#optimization-techniques">Optimization Techniques</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#id1">Triton</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#gpu-programming">GPU Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#deep-learning">Deep Learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#nvidia-tools">NVIDIA Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#amd-tools">AMD Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#pytorch-profiler">PyTorch Profiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#benchmarking">Benchmarking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#tutorials-and-courses">Tutorials and Courses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#community">Community</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#blogs-and-articles">Blogs and Articles</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#triton-examples">Triton Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#production-usage">Production Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#nvidia-gpus">NVIDIA GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#amd-gpus">AMD GPUs</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#subscribe-to">Subscribe To</a></li>
<li class="toctree-l1"><a class="reference internal" href="../references.html#conferences">Conferences</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Fast Concurrent Programming Guide</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Without task_done() - Can’t Track Completion</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/cpu-concurrency/task_done_queue_explained.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>task_done() and Queue Explained: Counter &amp; Condition Variables</p>
<p>Quick Answer</p>
<p><code class="docutils literal notranslate"><span class="pre">task_done()</span></code> is used to <strong>track when you’ve finished processing an item</strong>, so that <code class="docutils literal notranslate"><span class="pre">queue.join()</span></code> knows when ALL items have been processed.</p>
<p><strong>Yes, ``task_done()`` is on the Queue and does TWO things:</strong></p>
<ol class="arabic simple">
<li><p><strong>Decrements the task counter</strong> - Tracks unfinished tasks</p></li>
<li><p><strong>Notifies the join() condition</strong> - Wakes up <code class="docutils literal notranslate"><span class="pre">queue.join()</span></code> if counter reaches 0</p></li>
</ol>
<p>—</p>
<p>The Problem Without task_done()</p>
<section id="without-task-done-can-t-track-completion">
<h1>Without task_done() - Can’t Track Completion<a class="headerlink" href="#without-task-done-can-t-track-completion" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from threading import Thread
import time</p>
<p>queue = Queue()</p>
<dl class="simple">
<dt>def producer():</dt><dd><dl class="simple">
<dt>for i in range(3):</dt><dd><p>queue.put(f”Task {i}”)
print(f”Produced Task {i}”)</p>
</dd>
</dl>
</dd>
<dt>def consumer():</dt><dd><dl class="simple">
<dt>for i in range(3):</dt><dd><p>item = queue.get()
print(f”Processing {item}”)
time.sleep(1)  # Simulate work
print(f”Finished {item}”)
# NO task_done() here!</p>
</dd>
</dl>
</dd>
</dl>
<p>producer_thread = Thread(target=producer)
consumer_thread = Thread(target=consumer)</p>
<p>producer_thread.start()
consumer_thread.start()</p>
<p>producer_thread.join()
consumer_thread.join()</p>
<p>How do we know if ALL items have been processed?
WE DON’T! Consumer might still be working!
.. code-block:: text</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from threading import Thread
import time</p>
<p>queue = Queue()</p>
<dl class="simple">
<dt>def producer():</dt><dd><dl class="simple">
<dt>for i in range(3):</dt><dd><p>queue.put(f”Task {i}”)
print(f”Produced Task {i}”)</p>
</dd>
</dl>
</dd>
<dt>def consumer():</dt><dd><dl class="simple">
<dt>for i in range(3):</dt><dd><p>item = queue.get()
print(f”Processing {item}”)
time.sleep(1)  # Simulate work
print(f”Finished {item}”)
queue.task_done()  # Tell queue we’re done!</p>
</dd>
</dl>
</dd>
</dl>
<p>producer_thread = Thread(target=producer)
consumer_thread = Thread(target=consumer)</p>
<p>producer_thread.start()
consumer_thread.start()</p>
<p>producer_thread.join()
consumer_thread.join()</p>
<p>queue.join()  # NOW we can safely wait for all items to be processed!
print(“All tasks complete!”)
.. code-block:: text</p>
<p>How task_done() Works</p>
</section>
<section id="internal-counter-system">
<h1>Internal Counter System<a class="headerlink" href="#internal-counter-system" title="Link to this heading"></a></h1>
<p>Queue maintains an <strong>internal task counter</strong>:</p>
<p>Initial state: task_counter = 0</p>
<p>put(item1)    -&gt; task_counter = 1
put(item2)    -&gt; task_counter = 2
put(item3)    -&gt; task_counter = 3</p>
<p>get()         -&gt; Returns item1 (counter still 3)
task_done()   -&gt; task_counter = 2 (decrement)</p>
<p>get()         -&gt; Returns item2 (counter still 2)
task_done()   -&gt; task_counter = 1 (decrement)</p>
<p>get()         -&gt; Returns item3 (counter still 1)
task_done()   -&gt; task_counter = 0 (decrement)</p>
<p>join()        -&gt; Returns immediately (counter = 0)</p>
</section>
<section id="visual-timeline">
<h1>Visual Timeline<a class="headerlink" href="#visual-timeline" title="Link to this heading"></a></h1>
<p>Producer         Queue           Consumer          Main
put(1)          [1]</p>
<blockquote>
<div><p>counter=1</p>
<blockquote>
<div><p>get() -&gt; gets 1
counter=1 (unchanged)
processing…
task_done()
counter=0</p>
<blockquote>
<div><p>join()
BLOCKED
(counter=0)
CONTINUES!</p>
</div></blockquote>
</div></blockquote>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>What task_done() Actually Does</p>
</section>
<section id="code-simplified">
<h1>Code (Simplified)<a class="headerlink" href="#code-simplified" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;task_done() called too many times&#39;</span><span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># Decrement counter</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>  <span class="c1"># Wake up join()</span>
</pre></div>
</div>
</section>
<section id="two-operations">
<h1>Two Operations<a class="headerlink" href="#two-operations" title="Link to this heading"></a></h1>
<p>task_done() does:</p>
<ol class="arabic">
<li><p>Decrement counter
| counter: 3   |</p>
<blockquote>
<div><div class="line-block">
<div class="line">task_done()</div>
</div>
<p>[v]</p>
</div></blockquote>
<div class="line-block">
<div class="line">counter: 2   | &lt;- Just decremented</div>
</div>
</li>
<li><p>Check if counter = 0, then notify all_tasks*done
| counter: 1   |</p>
<blockquote>
<div><div class="line-block">
<div class="line">task_done()</div>
</div>
<p>[v]</p>
</div></blockquote>
<div class="line-block">
<div class="line">counter: 0   | &lt;- All tasks done!</div>
<div class="line">Notify!      | &lt;- Wakes join()</div>
</div>
</li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>The Third Condition Variable: all_tasks*done</p>
<p>Queue has <strong>THREE</strong> condition variables:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">__init</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_empty</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>      <span class="c1"># put() signals, get() waits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_full</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span>       <span class="c1"># get() signals, put() waits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span> <span class="o">=</span> <span class="n">Condition</span><span class="p">()</span> <span class="c1"># task_done() signals, join() waits</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</section>
<section id="timeline-all-three-conditions">
<h1>Timeline: All Three Conditions<a class="headerlink" href="#timeline-all-three-conditions" title="Link to this heading"></a></h1>
<p>Queue Object:
| Condition: not_empty                |
| <a href="#id1"><span class="problematic" id="id2">|</span></a>- Signaled by: put()              |
| <a href="#id3"><span class="problematic" id="id4">|</span></a>- Waited on by: get()             |
| +- Purpose: “Data available”       |
| Condition: not_full                 |
| <a href="#id5"><span class="problematic" id="id6">|</span></a>- Signaled by: get()              |
| <a href="#id7"><span class="problematic" id="id8">|</span></a>- Waited on by: put()             |
| +- Purpose: “Space available”      |
| Condition: all_tasks*done           |
| <a href="#id9"><span class="problematic" id="id10">|</span></a>- Signaled by: task_done()        | &lt;- YOUR QUESTION!
| <a href="#id11"><span class="problematic" id="id12">|</span></a>- Waited on by: join()            |
| +- Purpose: “All work processed”   |
| Counter: unfinished_tasks           |
| <a href="#id13"><span class="problematic" id="id14">|</span></a>- Incremented by: put()           |
| <a href="#id15"><span class="problematic" id="id16">|</span></a>- Decremented by: task_done()     |
| +- Checked by: join()              |
.. code-block:: text</p>
<p>Complete Picture: All Operations</p>
</section>
<section id="put">
<h1>put()<a class="headerlink" href="#put" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_full</span><span class="p">:</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxsize</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">not_full</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">+=</span> <span class="mi">1</span>  <span class="c1"># &lt;- Increment here!</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_empty</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="get">
<h1>get()<a class="headerlink" href="#get" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">not_empty</span><span class="p">:</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">not_empty</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>

    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">items</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">not_full</span><span class="o">.</span><span class="n">notify</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">item</span>  <span class="c1"># &lt;- Returns just the item</span>
</pre></div>
</div>
</section>
<section id="task-done">
<h1>task_done()<a class="headerlink" href="#task-done" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># &lt;- Decrement here!</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>  <span class="c1"># &lt;- Notify join()!</span>
</pre></div>
</div>
</section>
<section id="join">
<h1>join()<a class="headerlink" href="#join" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span><span class="p">:</span>
    <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span><span class="o">.</span><span class="n">wait</span><span class="p">()</span>  <span class="c1"># &lt;- Waits here!</span>
    <span class="c1"># When counter reaches 0, task_done() wakes this up</span>
</pre></div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>The Complete Flow with All Three Conditions</p>
</section>
<section id="scenario-1-producer-1-consumer">
<h1>Scenario: 1 Producer, 1 Consumer<a class="headerlink" href="#scenario-1-producer-1-consumer" title="Link to this heading"></a></h1>
<p>Time  Producer        get()           task_done()      Consumer Waits</p>
<dl>
<dt>0     put(1)</dt><dd><blockquote>
<div><p>[v]</p>
</div></blockquote>
<p>get() wakes up</p>
</dd>
</dl>
<p>1                                    Processing item…</p>
<dl>
<dt>2                                    task_done()</dt><dd><blockquote>
<div><p>[v]</p>
</div></blockquote>
<p>join() wakes up!
Returns!</p>
</dd>
</dl>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Detailed Breakdown: task_done() with Counter</p>
</section>
<section id="step-1-put-increment-counter">
<h1>Step 1: put() - Increment Counter<a class="headerlink" href="#step-1-put-increment-counter" title="Link to this heading"></a></h1>
<p>Initial state:
| unfinished_tasks: 0  |
| items: []            |</p>
<p>put(1) called:
.. code-block:: text</p>
<hr class="docutils" />
<p>Before get():
| unfinished_tasks: 1  | &lt;- Still 1!
| items: [1]           |</p>
<p>get() called:
.. code-block:: text</p>
<hr class="docutils" />
<p>Before task_done():
| unfinished_tasks: 1  |
| items: []            |</p>
<p>task_done() called:
.. code-block:: text</p>
<hr class="docutils" />
<p>join() called (from main thread):</p>
<p>[task_done() is called from consumer thread]
[unfinished_tasks becomes 0]
[task_done() calls notify_all()]</p>
<blockquote>
<div><p>Main thread can continue!</p>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>The Counter Lifecycle</p>
</section>
<section id="diagram-tracking-one-task">
<h1>Diagram: Tracking One Task<a class="headerlink" href="#diagram-tracking-one-task" title="Link to this heading"></a></h1>
<p>Lifecycle of Task #1:</p>
<dl class="simple">
<dt>put(task1)</dt><dd><p>down</p>
</dd>
<dt>unfinished_tasks = 1</dt><dd><p>down</p>
</dd>
<dt>get() -&gt; task1</dt><dd><p>down</p>
</dd>
<dt>unfinished_tasks = 1 (unchanged)</dt><dd><p>down</p>
</dd>
<dt>[Processing task1…]</dt><dd><p>down</p>
</dd>
<dt>task_done()</dt><dd><p>down</p>
</dd>
<dt>unfinished_tasks = 0 &lt;- Counter decremented!</dt><dd><p>down</p>
</dd>
<dt>all_tasks*done.notify_all()</dt><dd><p>down</p>
</dd>
</dl>
<p>join() wakes up (if counter = 0)</p>
</section>
<section id="diagram-multiple-tasks">
<h1>Diagram: Multiple Tasks<a class="headerlink" href="#diagram-multiple-tasks" title="Link to this heading"></a></h1>
<p>Multiple tasks lifecycle:</p>
<p>put(t1) -&gt; unfinished=1
put(t2) -&gt; unfinished=2
put(t3) -&gt; unfinished=3</p>
<dl class="simple">
<dt>get()-&gt;t1, get()-&gt;t2, get()-&gt;t3</dt><dd><p>unfinished=3 (unchanged)</p>
</dd>
</dl>
<p>[Processing all…]</p>
<p>task_done()  -&gt; unfinished=2
task_done()  -&gt; unfinished=1
task_done()  -&gt; unfinished=0 &lt;- Reached 0!</p>
<blockquote>
<div><p>all_tasks*done.notify_all()</p>
</div></blockquote>
<p>join() was waiting…
Now wakes up! &lt;- Can continue
.. code-block:: text</p>
<p>Key Insight: Two Data Flows</p>
<p>Queue has TWO independent data flows:</p>
<ol class="arabic simple">
<li><p>ITEM FLOW:
put() -&gt; [items list] -&gt; get()
Signal: not_empty (consumer waits for items)
Signal: not_full (producer waits for space)</p></li>
<li><p>COMPLETION FLOW:
put() -&gt; [unfinished_tasks counter] -&gt; task_done()
Signal: all_tasks*done (join() waits for completion)</p></li>
</ol>
<p>These are INDEPENDENT:
- get() doesn’t care if task_done() was called
- task_done() doesn’t remove items from list
- They work in parallel
.. code-block:: text</p>
<p>Why BOTH Counter AND Condition Variable?</p>
</section>
<section id="counter">
<h1>Counter<a class="headerlink" href="#counter" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Tracks how many items haven’t been marked done yet
Used to know WHEN to signal
Checked by join()</p>
</section>
<section id="condition-variable">
<h1>Condition Variable<a class="headerlink" href="#condition-variable" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Efficiently wakes up waiting threads
Avoids busy-waiting
Used by join() to sleep instead of spinning</p>
</section>
<section id="together">
<h1>Together<a class="headerlink" href="#together" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">-=</span> <span class="mi">1</span>  <span class="c1"># &lt;- Update counter</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">unfinished_tasks</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># &lt;- Check counter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">all_tasks</span><span class="o">*</span><span class="n">done</span><span class="o">.</span><span class="n">notify_all</span><span class="p">()</span>  <span class="c1"># &lt;- Use condition</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Counter</span> <span class="n">answers</span> <span class="s2">&quot;when?&quot;</span><span class="o">**</span>
<span class="o">**</span><span class="n">Condition</span> <span class="n">variable</span> <span class="n">answers</span> <span class="s2">&quot;how to signal efficiently?&quot;</span><span class="o">**</span>
</pre></div>
</div>
</section>
<section id="without-all-tasks-done-condition">
<h1>Without all_tasks*done Condition<a class="headerlink" href="#without-all-tasks-done-condition" title="Link to this heading"></a></h1>
<p>If Queue only had counter but NO condition variable:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl class="simple">
<dt>def join_without*condition(self):</dt><dd><dl class="simple">
<dt>while self.unfinished_tasks &gt; 0:</dt><dd><p>time.sleep(0.01)  # Busy-wait, bad!
# Keeps waking up to check, wastes CPU</p>
</dd>
</dl>
</dd>
</dl>
<p>RIGHT - Uses condition variable
def join_with*condition(self):</p>
<blockquote>
<div><dl class="simple">
<dt>with self.all_tasks*done:</dt><dd><dl class="simple">
<dt>while self.unfinished_tasks &gt; 0:</dt><dd><p>self.all_tasks*done.wait()  # Sleep efficiently
# Only wakes up when task_done() signals</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Visual: Counter and Condition Together</p>
<p>Queue internals:</p>
<div class="line-block">
<div class="line">unfinished_tasks Counter               |</div>
<div class="line">| Value: 3                             ||</div>
<div class="line">| - Incremented by put()              ||</div>
<div class="line">| - Decremented by task_done()        ||</div>
<div class="line">| - Checked by join()                 ||</div>
<div class="line">all_tasks*done Condition Variable      |</div>
<div class="line">| Waiting threads: [join_thread]      ||</div>
<div class="line">| - Signaled by task_done()           ||</div>
<div class="line">| - Waited on by join()               ||</div>
<div class="line">| - Notifies when counter = 0         ||</div>
</div>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>Complete Operation Table</p>
<div class="line-block">
<div class="line">Operation | What it touches | Effect |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">put(item)</span></code> | items list | Appends item |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">put(item)</span></code> | unfinished_tasks | Increments |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">put(item)</span></code> | not_empty | Notifies consumer |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">get()</span></code> | items list | Pops item |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">get()</span></code> | unfinished_tasks | No change! |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">get()</span></code> | not_full | Notifies producer |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">task_done()</span></code> | unfinished_tasks | Decrements |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">task_done()</span></code> | all_tasks*done | Notifies join() |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">join()</span></code> | unfinished_tasks | Checks if 0 |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">join()</span></code> | all_tasks*done | Waits on it |</div>
</div>
<p>—</p>
<p>What Happens WITHOUT task_done()</p>
</section>
<section id="queue-join-without-task-done">
<h1>Queue.join() Without task_done()<a class="headerlink" href="#queue-join-without-task-done" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>queue.put(1)
queue.put(2)
queue.put(3)</p>
<p>item = queue.get()  # Get all items
item = queue.get()
item = queue.get()</p>
<p>NO task_done() calls!</p>
<dl class="simple">
<dt>queue.join()  # BLOCKS FOREVER!</dt><dd><p># Queue still thinks 3 items are “unprocessed”
# Counter never decrements to 0</p>
</dd>
</dl>
</section>
<section id="why-it-blocks-forever">
<h1>Why It Blocks Forever<a class="headerlink" href="#why-it-blocks-forever" title="Link to this heading"></a></h1>
<p>Queue state:
| items: []                   |  &lt;- All removed
| task_counter: 3             |  &lt;- Still 3! Never decremented</p>
<dl class="simple">
<dt>join() checks: if task_counter != 0: wait()</dt><dd><p>3 != 0, so WAIT FOREVER</p>
</dd>
</dl>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>What Happens WITH task_done()</p>
</section>
<section id="queue-join-with-task-done">
<h1>Queue.join() With task_done()<a class="headerlink" href="#queue-join-with-task-done" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>queue.put(1)      # task_counter = 1
queue.put(2)      # task_counter = 2
queue.put(3)      # task_counter = 3</p>
<p>item = queue.get()  # task_counter = 3 (unchanged)
queue.task_done()   # task_counter = 2 (decremented!)</p>
<p>item = queue.get()  # task_counter = 2 (unchanged)
queue.task_done()   # task_counter = 1 (decremented!)</p>
<p>item = queue.get()  # task_counter = 1 (unchanged)
queue.task_done()   # task_counter = 0 (decremented!)</p>
<p>queue.join()  # task_counter = 0, so continues immediately!
print(“Done!”)</p>
</section>
<section id="why-it-works">
<h1>Why It Works<a class="headerlink" href="#why-it-works" title="Link to this heading"></a></h1>
<p>Queue state after all task_done():
| items: []                   |  &lt;- All removed
| task_counter: 0             |  &lt;- All decremented to 0</p>
<dl class="simple">
<dt>join() checks: if task_counter != 0: wait()</dt><dd><p>0 == 0, so CONTINUE (don’t wait)</p>
</dd>
</dl>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>The Three-Step Cycle</p>
</section>
<section id="step-1-put-item">
<h1>Step 1: Put Item<a class="headerlink" href="#step-1-put-item" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>task_counter increments</p>
</section>
<section id="step-2-get-and-process">
<h1>Step 2: Get and Process<a class="headerlink" href="#step-2-get-and-process" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>task_counter STAYS the same
(item is “in flight”, being processed)
process(item)       # Do actual work</p>
</section>
<section id="step-3-mark-done">
<h1>Step 3: Mark Done<a class="headerlink" href="#step-3-mark-done" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>task_counter decrements
Tells queue: “I’m done with this item”</p>
</section>
<section id="flow-diagram">
<h1>Flow Diagram<a class="headerlink" href="#flow-diagram" title="Link to this heading"></a></h1>
<dl class="simple">
<dt>put(A)       get()      task_done()    queue state</dt><dd><p>down            down            down</p>
</dd>
<dt>[A]          (processing)   [OK]          counter: 1-&gt;0</dt><dd><p>down            down            down</p>
</dd>
</dl>
<p>counter=1   counter=1   counter=0
.. code-block:: text</p>
<p>Real Example: Work Queue Pattern</p>
</section>
<section id="without-task-done-problematic">
<h1>Without task_done() - PROBLEMATIC<a class="headerlink" href="#without-task-done-problematic" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from threading import Thread</p>
<p>tasks = Queue()</p>
<section id="add-tasks">
<h2>Add tasks<a class="headerlink" href="#add-tasks" title="Link to this heading"></a></h2>
<dl>
<dt>for i in range(5):</dt><dd><p>tasks.put(f”Task {i}”)</p>
</dd>
<dt>def worker():</dt><dd><dl>
<dt>while True:</dt><dd><p>task = tasks.get()
if task is None:</p>
<blockquote>
<div><p>break</p>
</div></blockquote>
<p>print(f”Working on {task}”)
# Do work here…
# NO task_done()!</p>
</dd>
</dl>
</dd>
</dl>
<p>Start worker
t = Thread(target=worker)
t.start()</p>
<p>Main thread wants to know when all work is done
tasks.join()  # BLOCKS FOREVER!
print(“All done!”)  # Never prints!</p>
<p>Send poison pill to stop worker
tasks.put(None)
t.join()</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Output</span><span class="p">:</span><span class="o">**</span>
</pre></div>
</div>
<p>Working on Task 0
Working on Task 1
Working on Task 2
Working on Task 3
Working on Task 4
[Program hangs, never says “All done!”]
.. code-block:: text</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from threading import Thread</p>
<p>tasks = Queue()</p>
</section>
<section id="id17">
<h2>Add tasks<a class="headerlink" href="#id17" title="Link to this heading"></a></h2>
<dl>
<dt>for i in range(5):</dt><dd><p>tasks.put(f”Task {i}”)</p>
</dd>
<dt>def worker():</dt><dd><dl>
<dt>while True:</dt><dd><p>task = tasks.get()
if task is None:</p>
<blockquote>
<div><p>break</p>
</div></blockquote>
<p>print(f”Working on {task}”)
# Do work here…
tasks.task_done()  # IMPORTANT!</p>
</dd>
</dl>
</dd>
</dl>
<p>Start worker
t = Thread(target=worker)
t.start()</p>
<p>Main thread waits for all work to be done
tasks.join()  # Returns when all task_done() called
print(“All done!”)  # Now prints!</p>
<p>Send poison pill to stop worker
tasks.put(None)
t.join()</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Output</span><span class="p">:</span><span class="o">**</span>
</pre></div>
</div>
<p>Working on Task 0
Working on Task 1
Working on Task 2
Working on Task 3
Working on Task 4
All done!
.. code-block:: text</p>
<p>Why Is This Useful?</p>
</section>
</section>
<section id="use-case-1-verify-all-work-complete">
<h1>Use Case 1: Verify All Work Complete<a class="headerlink" href="#use-case-1-verify-all-work-complete" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl class="simple">
<dt>for task in tasks:</dt><dd><p>queue.put(task)</p>
</dd>
</dl>
<p>Wait for workers to finish ALL tasks
queue.join()</p>
<p>NOW we know all work is done
print(“All tasks processed successfully!”)
save_results()
shutdown_workers()</p>
</section>
<section id="use-case-2-track-progress">
<h1>Use Case 2: Track Progress<a class="headerlink" href="#use-case-2-track-progress" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl>
<dt>for i in range(100):</dt><dd><p>queue.put(i)</p>
</dd>
<dt>def worker():</dt><dd><dl>
<dt>while True:</dt><dd><p>task = queue.get()
if task is None:</p>
<blockquote>
<div><p>break</p>
</div></blockquote>
<p>process(task)
queue.task_done()</p>
</dd>
</dl>
</dd>
</dl>
<p>workers = [Thread(target=worker) for * in range(4)]
for w in workers:</p>
<blockquote>
<div><p>w.start()</p>
</div></blockquote>
<p>Wait for completion
queue.join()
print(f”All 100 tasks completed!”)</p>
</section>
<section id="use-case-3-batch-processing">
<h1>Use Case 3: Batch Processing<a class="headerlink" href="#use-case-3-batch-processing" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<dl>
<dt>def add_to*batch(item):</dt><dd><p>batch_queue.put(item)</p>
</dd>
<dt>def process_batch():</dt><dd><p>batch = []
while True:</p>
<blockquote>
<div><p>item = batch_queue.get()
if item is None:</p>
<blockquote>
<div><p>process_batch*now(batch)
break</p>
</div></blockquote>
<p>batch.append(item)
batch_queue.task_done()</p>
<dl class="simple">
<dt>if len(batch) == 10:</dt><dd><p>process_batch*now(batch)
batch = []</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
<section id="main">
<h2>Main<a class="headerlink" href="#main" title="Link to this heading"></a></h2>
<dl class="simple">
<dt>for i in range(50):</dt><dd><p>add_to*batch(i)</p>
</dd>
</dl>
<p>Wait until all batches processed
batch_queue.join()
print(“All batches processed!”)
.. code-block:: text</p>
<p>Comparison: With vs Without task_done()</p>
</section>
</section>
<section id="scenario-main-thread-needs-to-know-when-workers-finish">
<h1>Scenario: Main thread needs to know when workers finish<a class="headerlink" href="#scenario-main-thread-needs-to-know-when-workers-finish" title="Link to this heading"></a></h1>
<div class="line-block">
<div class="line">Without task_done() | With task_done() |</div>
<div class="line"><code class="docutils literal notranslate"><span class="pre">queue.join()</span></code> blocks forever | <code class="docutils literal notranslate"><span class="pre">queue.join()</span></code> returns when done |</div>
<div class="line">Can’t track progress | Can track completion |</div>
<div class="line">Unpredictable behavior | Predictable, reliable |</div>
<div class="line">No way to know if work finished | Clear completion signal |</div>
</div>
<p>—</p>
<p>The Flow in Your Code (05*queue.py)</p>
<p>Looking back at the code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">__init</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
    <span class="n">Thread</span><span class="o">.**</span><span class="n">init</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue</span>

<span class="k">def</span><span class="w"> </span><span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>           <span class="c1"># Step 1: Remove from queue</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;consumer: got </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>    <span class="c1"># Step 2: Do work</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>            <span class="c1"># Step 3: Mark as done</span>
</pre></div>
</div>
</section>
<section id="timeline">
<h1>Timeline<a class="headerlink" href="#timeline" title="Link to this heading"></a></h1>
<p>Producer puts 5 items in 5 seconds</p>
<p>Meanwhile, 3 consumers get and process:
Consumer1: get(42) -&gt; task_done() -&gt; counter = 4
Consumer2: get(7) -&gt; task_done() -&gt; counter = 3
Consumer3: get(199) -&gt; task_done() -&gt; counter = 2
Consumer1: get(88) -&gt; task_done() -&gt; counter = 1
Consumer2: get(12) -&gt; task_done() -&gt; counter = 0</p>
<p>Main thread: producer.join() completes at 4s
Main thread: But consumers are in infinite loop (while True)
Main thread: Tries to join consumers (would block forever)
.. code-block:: text</p>
<p>The Missing Piece in the Code</p>
<p>The code has an issue - consumers have <code class="docutils literal notranslate"><span class="pre">while</span> <span class="pre">True</span></code> (infinite loop):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>  <span class="c1"># Never exits!</span>
    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;consumer notify: item popped from queue by </span><span class="si">{</span><span class="n">item</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="better-code-pattern">
<h1>Better Code Pattern<a class="headerlink" href="#better-code-pattern" title="Link to this heading"></a></h1>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
    <span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">item</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># Poison pill - signal to exit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
        <span class="k">break</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;consumer: processing </span><span class="si">{</span><span class="n">item</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">task_done</span><span class="p">()</span>
</pre></div>
</div>
<section id="in-main">
<h2>In main<a class="headerlink" href="#in-main" title="Link to this heading"></a></h2>
<p>producer.join()
queue.join()  # All items processed</p>
<p>Stop consumers
for * in range(3):</p>
<blockquote>
<div><p>queue.put(None)  # Poison pill</p>
</div></blockquote>
<p>consumer1.join()
consumer2.join()
consumer3.join()
.. code-block:: text</p>
<p>Summary: What task_done() Does</p>
<p><strong>YES, task_done() is on Queue and does:</strong></p>
<ol class="arabic simple">
<li><p><strong>Decrements unfinished_tasks counter</strong> by 1
- Tracks how many items still need processing</p></li>
<li><p><strong>Checks if counter reached 0</strong>
- If yes: ALL items processed</p></li>
<li><p><strong>Notifies all_tasks*done condition variable</strong> (if counter = 0)
- Wakes up any threads waiting on <code class="docutils literal notranslate"><span class="pre">join()</span></code>
- Uses <code class="docutils literal notranslate"><span class="pre">notify_all()</span></code> to wake ALL waiters</p></li>
</ol>
<p><strong>The counter tracks WHAT, the condition signals HOW.</strong></p>
</section>
</section>
<section id="why-we-need-task-done">
<h1>Why We Need task_done()<a class="headerlink" href="#why-we-need-task-done" title="Link to this heading"></a></h1>
<ol class="arabic simple">
<li><p><strong>Tracks Completion</strong> - Queue knows when items are processed</p></li>
<li><p><strong>Enables join()</strong> - <code class="docutils literal notranslate"><span class="pre">queue.join()</span></code> knows when to return</p></li>
<li><p><strong>Prevents Hanging</strong> - Without it, <code class="docutils literal notranslate"><span class="pre">join()</span></code> blocks forever</p></li>
<li><p><strong>Progress Tracking</strong> - Count which items are done</p></li>
<li><p><strong>Synchronization</strong> - Coordinate main thread with workers</p></li>
</ol>
</section>
<section id="the-pattern">
<h1>The Pattern<a class="headerlink" href="#the-pattern" title="Link to this heading"></a></h1>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>down
</pre></div>
</div>
<dl class="simple">
<dt>get(item)      -&gt; “Someone took the item”</dt><dd><p>down</p>
</dd>
<dt>task_done()    -&gt; “Item was PROCESSED”</dt><dd><p>down</p>
</dd>
</dl>
<p>join()         -&gt; “All items PROCESSED?” -&gt; Yes -&gt; Continue</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>**Without ``task_done()``, ``join()`` can never verify all items are truly processed!**
</pre></div>
</div>
<p>—</p>
<p>Real Code Example</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<p>from threading import Thread
import time</p>
<p>q = Queue()</p>
<dl>
<dt>def producer():</dt><dd><dl class="simple">
<dt>for i in range(3):</dt><dd><p>q.put(f”Task {i}”)
print(f”Put Task {i}, unfinished_tasks now = {q.unfinished_tasks}”)</p>
</dd>
</dl>
</dd>
<dt>def consumer():</dt><dd><dl>
<dt>while True:</dt><dd><p>item = q.get()
if item is None:</p>
<blockquote>
<div><p>break</p>
</div></blockquote>
<p>print(f”Got {item}, unfinished_tasks still = {q.unfinished_tasks}”)
time.sleep(0.5)
q.task_done()
print(f”Marked {item} done, unfinished_tasks now = {q.unfinished_tasks}”)</p>
</dd>
</dl>
</dd>
</dl>
<p>t1 = Thread(target=producer)
t2 = Thread(target=consumer)</p>
<p>t1.start()
t2.start()</p>
<p>t1.join()</p>
<p>Now wait for consumer to finish processing ALL items
print(“Waiting for all tasks to be processed…”)
q.join()  # Waits here until counter reaches 0
print(“All tasks processed!”)</p>
<p>q.put(None)  # Stop consumer
t2.join()</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">**</span><span class="n">Output</span><span class="p">:</span><span class="o">**</span>
</pre></div>
</div>
<p>Put Task 0, unfinished_tasks now = 1
Put Task 1, unfinished_tasks now = 2
Put Task 2, unfinished_tasks now = 3
Got Task 0, unfinished_tasks still = 3
Marked Task 0 done, unfinished_tasks now = 2
Got Task 1, unfinished_tasks still = 2
Marked Task 1 done, unfinished_tasks now = 1
Got Task 2, unfinished_tasks still = 1
Marked Task 2 done, unfinished_tasks now = 0
Waiting for all tasks to be processed…
All tasks processed!</p>
<p>Notice how <code class="docutils literal notranslate"><span class="pre">task_done()</span></code> decrements the counter, and when it reaches 0, <code class="docutils literal notranslate"><span class="pre">join()</span></code> returns!</p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="queue_internal_mechanics.html" class="btn btn-neutral float-left" title="The Answer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="rlock_explained.html" class="btn btn-neutral float-right" title="Regular Lock vs RLock" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Fast Concurrent Programs.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>